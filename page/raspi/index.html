<html>
<head>

	<script src="js/jquery.js"></script>
	<!-- <script src="_assets/js/index.js"></script> --!>
	<script src="js/jquery.mobile-1.4.5.min.js"></script>
	<link rel="stylesheet" href="css/themes/default/jquery.mobile-1.4.5.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
.dirItem {
 color: black !important
}
.fileItem{
color: green !important
}
.ui-flipswitch {
    margin-right: 10px;
    float: right;
}
</style>
</head>
<body>
<div data-role="page" id="main">
<div data-role="header">
   <h1>Raspi</h1>
   <a href="http://192.168.1.117" class="ui-btn-right">VLC</a>
</div>
<ul data-role="listview">
<li>
    <div>
    <span>Socket 4</span>
    <input data-role="flipswitch" name="flip-s4" id="flip-s4" type="checkbox">
    </div>
</li>
</ul>
<label for="vol-slider">Volume:</label>
<input name="volume-slider" id="vol-slider" min="0" max="100" value="50" type="range" data-highlight="true">
<!-- Navigation buttons -->
<fieldset class="ui-grid-a">
<div class="ui-block-a"><button  value="Backward" type="button" id="btn-back">Backward</button></div>
<div class="ui-block-b"><button  value="Forward" type="button" id="btn-forward">Forward</button></div>
</fieldset>
<fieldset class="ui-grid-a">
<div class="ui-block-a"><button  type="button" id="btn-fullscreen">Fullscreen</button></div>
<div class="ui-block-b"><button  type="button" id="btn-audio">Switch audio</button></div>
</fieldset>

<button  value="Pause/Play" type="button" id="btn-pplay">Pause/Play</button>
<button  value="Browse" type="button" id="btn-browse">Browse</button>
<button  value="Browse" type="button" id="btn-browse-twitch">Browse Games</button>
<button  value="Radio" type="button" id="btn-stations">Radio</button>
<button  value="Radio" type="button" id="btn-stop">Stop</button>

</div><!-- main page-->

<div data-role="page" id="stations">
   <div data-role="header" id="stations-hdr">
   Dirble
   </div>
   <ul data-role="listview" id="lst-stations">
   </ul>
<fieldset class="ui-grid-a">
<div class="ui-block-a"><button  type="button" id="btn-prev">Prev</button></div>
<div class="ui-block-b"><button  type="button" id="btn-next">Next</button></div>
</fieldset>
</div> <!-- stations page -->
<div data-role="page" id="browser">
   <div data-role="header" id="browser-hdr">
   / 
   </div>
   <ul data-role="listview" id="lst-dir" data-filter="true">
   </ul>
</div> <!-- browser page -->
<div data-role="page" id="twitch-browser">
   <div data-role="header" id="twitch-browser-hdr">
   / 
   </div>
   <ul data-role="listview" id="twitch-lst-dir" data-filter="true">
   </ul>
</div> <!-- twitch browser page -->

<script>
<!-- navigation buttons-->

$("#btn-pplay").bind("click", function(event, ui){
   $.get('srv/player/pplay')
})

$("#btn-audio").bind("click", function(event, ui){
   $.get('srv/player/audio')
})

$("#btn-fullscreen").bind("click", function(event, ui){
   $.get('srv/player/fullscreen')
})

$("#btn-forward").bind("click", function(event, ui){
   $.get('srv/player/forward')
})

$("#btn-back").bind("click", function(event, ui){
   $.get('srv/player/backward')
})

var current_page = 1
function stationsLoaded(data)
{
   try{
   var stations = JSON.parse(data)
    }
    catch(e)
    {
       window.alert(e.message + "\n Data:\n" + data)
       return
    }
   $('#lst-stations').empty()
   $('#stations-hdr').text('Page ' + current_page)
   for (station in stations)
   {
      var title = stations[station]['name']
      var st_id = stations[station]['id']
      $('#lst-stations').append('<li class="station" st_id="'+st_id+'">'
                                 + title +
                                '</li>')
   }
   $('#lst-stations').listview('refresh')
}
$('#lst-stations').on('click', 'li', function(){
   var item = $(this).html()
    var st_id = this.getAttribute('st_id')
    $.get('srv/radio/play/' + st_id )

})

$('#btn-stations').bind('click', function(event, ui){
   window.open('#stations', '_self')
   $.get('srv/radio/page/'+current_page, stationsLoaded)

})

$('#btn-prev').bind('click', function(event, ui){
    if(current_page > 1){
        $.get('srv/radio/page/' + --current_page, stationsLoaded)
    }
})
$('#btn-next').bind('click', function(event, ui){
    $.get('srv/radio/page/' + ++current_page, stationsLoaded)
})

$('#btn-stop').bind('click', function(event, ui){
    $.get('srv/radio/stop')
})

<!-- File browser section -->
var path = []
var last_position = 0

function browseHandle(data){
   var list = JSON.parse(data)
   $('#lst-dir').empty()
   var titles = []
/*
   for (p in path){
      titles.push(path[p]['title'])
   }*/
   $('#browser-hdr').text('/'+path.join('/'))
   if(path.length != 0){
      $('#lst-dir').append('<li>..</li>')
   }
   var dirs = list["dirs"]
   var files = list["files"]
   title_to_info = {}
   for (dir in dirs ){
      var title = dirs[dir]
      var el = $('<li>', { class:'dirItem'}).html(title)
      $('#lst-dir').append(el)
      }
   for (file in files ){
      var title = files[file]
      $('#lst-dir').append('<li class="fileItem">'+title+'</li>')
      }
   $('#lst-dir').listview('refresh')
   $.mobile.loading("hide")
   $(window).scrollTop(last_position)
}

function itemLoaded(data){
   $.mobile.loading("hide")
}

$('#lst-dir').on('click', 'li', function(){
   var item = $(this).html()
   var isDir = $(this).is(".dirItem")
   $.mobile.loading("show",{ 
      text:item,
      textVisible:true 
      })
   $('input[data-type="search"]').val("");
   if (item == '..'){
      path.pop()
      $('#lst-dir').empty().listview("refresh")
      $.get('srv/browse/'+ path.join('/'), browseHandle)
      return  
   }
   last_position = $(window).scrollTop()
   if (!isDir){
      $.get('srv/browse/'+path.join('/')+'/'+item , itemLoaded)
   } else {
      var id = title_to_info[item]
      path.push(item)
      $('#lst-dir').empty().listview("refresh")
      $.get('srv/browse/'+path.join('/'), browseHandle)
   }
})

$("#btn-browse").bind("click", function(event, ui){
   window.open('#browser', '_self')
   $.mobile.loading("show",{ 
      text:'/',
      textVisible:true 
      })

   $.get('srv/browse/'+path.join('/'), browseHandle)
})
<!-- twitch browser -->
var twitch_page = 0
function twitchBrowseHandle(data)
{
   var list = JSON.parse(data)
   $('#twitch-lst-dir').empty()
   for (stream in list ){
      var title = list[stream][0]
      var url = list[stream][1]
      $('#twitch-lst-dir').append('<li class="fileItem" twitch_url="'+url+'">'+title+'</li>')
      }
   $('#twitch-lst-dir').listview('refresh')
   $.mobile.loading("hide")
   $(window).scrollTop(last_position)
}

$("#btn-browse-twitch").bind("click", function(event, ui){
   window.open('#twitch-browser', '_self')
   $.mobile.loading("show",{ 
      text:'/',
      textVisible:true 
      })

   $.get('srv/twitch/search/starcraft/' + twitch_page, twitchBrowseHandle)
})

$('#twitch-lst-dir').on('click', 'li', function(){
   var item = $(this).html()
    var url = this.getAttribute('twitch_url')
    $.get('srv/twitch/play/' + url )

})
<!-- Page section -->

$(document).ready( function(){
   $.get('srv/socket/get/4', function(val){
    if (val == '1')
    {
        $('#flip-s4').prop('checked', true)
    }
    else
    {
        $('#flip-s4').prop('checked', false)
    }
    $('#flip-s4').flipswitch('refresh')
    $('#flip-s4').change(function()
    {
        if ($('#flip-s4').is(':checked'))
        {
            $.get('srv/socket/set/4/1')
        }
        else
        {
            $.get('srv/socket/set/4/0')
        }
    })
   })
    $.get('srv/radio/volume/get', function(val){

       var slider = $('#vol-slider')
       slider.val(val)
       slider.slider('refresh')

       $('#vol-slider').on('slidestop', function(event,ui){
           $.get('srv/radio/volume/set/' + slider.val())
       })

    })

if (document.URL.search('#browser')!= -1)
   $.get('srv/browse/', browseHandle)
});
</script>
</body>
</html>
