<html>
<head>

	<script src="js/jquery.js"></script>
	<!-- <script src="_assets/js/index.js"></script> --!>
	<script src="js/jquery.mobile-1.4.5.min.js"></script>
	<link rel="stylesheet" href="css/themes/default/jquery.mobile-1.4.5.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
.dirItem {
 color: black !important
}
.fileItem{
color: green !important
}
.ui-flipswitch {
    margin-right: 10px;
    float: right;
}
</style>
</head>
<body>
<div data-role="page" id="main">
<div data-role="header">
   <h1>Raspi</h1>
   <a href="http://192.168.1.117" class="ui-btn-right">VLC</a>
</div>
<ul data-role="listview">
<li>
    <div>
    <span>Socket 4</span>
    <input data-role="flipswitch" name="flip-s4" id="flip-s4" type="checkbox">
    </div>
</li>
<li>
    <div>
    <span>Socket 27</span>
    <input data-role="flipswitch" name="flip-s27" id="flip-s27" type="checkbox">
    </div>
</li>
</ul>
<label for="vol-slider">Volume:</label>
<input name="volume-slider" id="vol-slider" min="0" max="100" value="50" type="range" data-highlight="true">
<button  value="Radio" type="button" id="btn-stations">Radio</button>
<button  value="Radio" type="button" id="btn-stop">Stop</button>

</div><!-- main page-->

<div data-role="page" id="stations">
   <div data-role="header" id="stations-hdr">
   Dirble
   </div>
   <ul data-role="listview" id="lst-stations">
   </ul>
<fieldset class="ui-grid-a">
<div class="ui-block-a"><button  type="button" id="btn-prev">Prev</button></div>
<div class="ui-block-b"><button  type="button" id="btn-next">Next</button></div>
</fieldset>
</div> <!-- stations page -->

<script>

var current_page = 1
function stationsLoaded(data)
{
   try{
   var stations = JSON.parse(data)
    }
    catch(e)
    {
       window.alert(e.message + "\n Data:\n" + data)
       return
    }
   $('#lst-stations').empty()
   $('#stations-hdr').text('Page ' + current_page)
   for (station in stations)
   {
      var title = stations[station]['name']
      var st_id = stations[station]['id']
      $('#lst-stations').append('<li class="station" st_id="'+st_id+'">'
                                 + title +
                                '</li>')
   }
   $('#lst-stations').listview('refresh')
}
$('#lst-stations').on('click', 'li', function(){
   var item = $(this).html()
    var st_id = this.getAttribute('st_id')
    $.get('srv/radio/play/' + st_id )

})

$('#btn-stations').bind('click', function(event, ui){
   window.open('#stations', '_self')
   $.get('srv/radio/page/'+current_page, stationsLoaded)

})

$('#btn-prev').bind('click', function(event, ui){
    if(current_page > 1){
        $.get('srv/radio/page/' + --current_page, stationsLoaded)
    }
})
$('#btn-next').bind('click', function(event, ui){
    $.get('srv/radio/page/' + ++current_page, stationsLoaded)
})

$('#btn-stop').bind('click', function(event, ui){
    $.get('srv/radio/stop')
})

$(document).ready( function(){
   $.get('srv/socket/get/4', function(val){
    if (val == '0')
    {
        $('#flip-s4').prop('checked', true)
    }
    else
    {
        $('#flip-s4').prop('checked', false)
    }
    $('#flip-s4').flipswitch('refresh')
    $('#flip-s4').change(function()
    {
        if ($('#flip-s4').is(':checked'))
        {
            $.get('srv/socket/set/4/0')
        }
        else
        {
            $.get('srv/socket/set/4/1')
        }
    })
    $('#flip-s27').change(function(){
        if ($('#flip-s27').is(':checked'))
        {
            $.get('srv/socket/set/27/0')
        }
        else
        {
            $.get('srv/socket/set/27/1')
        }
    })
   })
    $.get('srv/radio/volume/get', function(val){

       var slider = $('#vol-slider')
       slider.val(val)
       slider.slider('refresh')

       $('#vol-slider').on('slidestop', function(event,ui){
           $.get('srv/radio/volume/set/' + slider.val())
       })

    })

});
</script>
</body>
</html>
