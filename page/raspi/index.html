<html>
<head>

<script src="js/jquery.js"></script>
<!-- <script src="_assets/js/index.js"></script> -->
<script src="js/jquery.mobile-1.4.5.min.js"></script>
<link rel="stylesheet" href="css/themes/default/jquery.mobile-1.4.5.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="./common.js"></script>
<link rel="stylesheet" type="text/css" href="./style.css">
</head>
<body>
<div data-role="page" id="main">
<div data-role="header">
   <h1>Raspi</h1>
</div>
<div id="player-info">Info</div>
<label for="pos-slider" class="ui-hidden-accessible">Position:</label>
<input name="pos-slider" id="pos-slider" min="0" max="100" value="0" type="range" data-highlight="true">
<ul data-role="listview">
<li>
    <div>
    <span>Socket 17</span>
    <input data-role="flipswitch" name="flip-s17" id="flip-s17" type="checkbox">
    </div>
</li>
</ul>
<label for="vol-slider">Volume:</label>
<input name="volume-slider" id="vol-slider" min="0" max="100" value="50" type="range" data-highlight="true">
<!-- Navigation buttons -->
<fieldset class="ui-grid-a">
<div class="ui-block-a"><button  value="Backward" type="button" id="btn-back">Backward</button></div>
<div class="ui-block-b"><button  value="Forward" type="button" id="btn-forward">Forward</button></div>
</fieldset>
<fieldset class="ui-grid-a">
<div class="ui-block-a"><button  type="button" id="btn-fullscreen">Fullscreen</button></div>
<div class="ui-block-b"><button  type="button" id="btn-audio">Switch audio</button></div>
</fieldset>
<div class="ui-grid-a">
<div class="ui-block-a">
<button  value="Pause/Play" type="button" id="btn-pplay"><img src="img/pplay.png"></button>
</div>
<div class="ui-block-b">
<button value="Youtube" type="button" id="btn-youtube"><img src="img/youtube.png"/></button>
</div>
<div class="ui-block-a">
<button  value="Browse" type="button" id="btn-browse"><img src="img/files.png"></button>
</div>
<div class="ui-block-b">
<button  value="Browse" type="button" id="btn-browse-twitch"><img src="img/twitch.png"/></button>
</div>
<div class="ui-block-a">
<button  value="Radio" type="button" id="btn-stations"><img src="img/radio.png"></button>
</div>
<div class="ui-block-b">
<button  value="Music" type="button" id="btn-music"><img src="img/music.png"/></button>
</div>
<div class="ui-block-a">
<button  value="Stop" type="button" id="btn-stop"><img src="img/stop.png"></button>
</div>
<div class="ui-block-b">
<button  value="System" type="button" id="btn-system"><img src="img/system.png"></button>
</div>
</div>
<div data-role="collapsible">
<h4><img src="img/tv.png"/></h4>
   <div class="ui-grid-a">
      <div class="ui-block-a">
         <button id="btn_ch1">112</button>
      </div>
      <div class="ui-block-b">
         <button id="btn_ch1">espresso</button>
      </div>
   </div>
</div>
</div><!-- main page-->

<div data-role="page" id="stations">
   <div data-role="header" id="stations-hdr">
   Dirble
   </div>
   <ul data-role="listview" id="lst-stations">
   </ul>
<fieldset class="ui-grid-a">
<div class="ui-block-a"><button  type="button" id="btn-prev">Prev</button></div>
<div class="ui-block-b"><button  type="button" id="btn-next">Next</button></div>
</fieldset>
</div> <!-- stations page -->
<div data-role="page" id="browser">
   <div data-role="header" id="browser-hdr">
   / 
   </div>
   <ul data-role="listview" id="lst-dir" data-filter="true">
   </ul>
</div> <!-- browser page -->

<div data-role="page" id="twitch-browser" data-theme="b">
   <div data-role="header" id="twitch-browser-hdr">
   / 
   </div>
   <ul data-role="listview" id="twitch-lst-dir" data-filter="true">
   </ul>
    <fieldset class="ui-grid-a">
    <div class="ui-block-a"><button  type="button" id="twitch-btn-prev">Prev</button></div>
    <div class="ui-block-b"><button  type="button" id="twitch-btn-next">Next</button></div>
    </fieldset>
    </div> <!-- twitch browser page -->
   
<div data-role="page" id="youtube-page" data-theme="a">
   <div data-role="header" id="youtube-hdr">
   / 
   </div>
   <form lpformnum="1" id="search-form">
       <label for="video-search">Search:</label>
       <input name="video-search" id="video-search" value="" type="search">
   </form>
   <ul data-role="listview" id="youtube-search-res">
   </ul>
    <fieldset class="ui-grid-a">
    <!--
    <div class="ui-block-a"><button  type="button" id="youtube-btn-prev">Prev</button></div>
    <div class="ui-block-b"><button  type="button" id="youtube-btn-next">Next</button></div>
    </fieldset>
    -->
    </div> <!-- youtube browser page -->

<div data-role="page" id="music-page" data-theme="a">
   <div data-role="header" id="music-hdr">
   / 
   </div>
   <ul data-role="listview" id="music-items">
   </ul>
    </div> <!-- music browser page -->

<div data-role="page" id="system-page" data-theme="a">
   <div data-role="header" id="system-hdr">
   System settings
   </div>
   <button type="button" id="btn-system-audio-hdmi">HDMI</button>
   <button type="button" id="btn-system-audio-analog">Speakers</button>
    </div> <!-- system page -->

 <div data-role="popup" id="dirPopup">
   <div id="popup-msg"></div>
   </div>

<script src="./raspi/script.js"></script>
<script>
<!-- navigation buttons-->

$("#btn-pplay").bind("click", function(event, ui){
   $.get('srv/player/pplay')
})

$("#btn-audio").bind("click", function(event, ui){
   $.get('srv/player/audio')
})

$("#btn-fullscreen").bind("click", function(event, ui){
   $.get('srv/player/fullscreen')
})

$("#btn-forward").bind("click", function(event, ui){
   $.get('srv/player/forward')
})

$("#btn-back").bind("click", function(event, ui){
   $.get('srv/player/backward')
})

<!-- Page section -->
function timeDigitToString(digit) {
   digit = String(digit)
   return digit.length == 1 ? "0"+digit : digit
}
function initStatus(data){
    updateInfo(data)
    var slider = $('#pos-slider')
    $('#pos-slider').on('slidestop', function(event,ui){
        $.get('srv/player/seek/' + slider.val())
    })
}

function updateInfo(data){
   var pos_info = JSON.parse(data)
   $("#player-info").html(format("%s:%s:%s - %s:%s:%s  %s",
                         [pos_info["totaltime"]["hours"],
                          timeDigitToString(pos_info["totaltime"]["minutes"]),
                          timeDigitToString(pos_info["totaltime"]["seconds"]),
                          pos_info["time"]["hours"],
                          timeDigitToString(pos_info["time"]["minutes"]),
                          timeDigitToString(pos_info["time"]["seconds"]),
                          pos_info["label"]
                          ]))
    var slider = $('#pos-slider')
    slider.val(pos_info["percentage"])
    slider.slider('refresh')
    setTimeout(function(){
      $.get('srv/player/info',updateInfo);
       },1500)
}

$(document).ready( function(){
   if (document.URL.search('#')==-1){
      $.get('srv/player/info',initStatus);
   }
   $.get('srv/socket/get/17', function(val){
    if (val == '1')
    {
        $('#flip-s17').prop('checked', true)
    }
    else
    {
        $('#flip-s17').prop('checked', false)
    }
    $('#flip-s17').flipswitch('refresh')
    $('#flip-s17').change(function()
    {
        if ($('#flip-s17').is(':checked'))
        {
            $.get('srv/socket/set/17/1')
        }
        else
        {
            $.get('srv/socket/set/17/0')
        }
    })
   })
    $.get('srv/player/volume/get', function(val){

       var slider = $('#vol-slider')
       slider.val(val)
       slider.slider('refresh')

       $('#vol-slider').on('slidestop', function(event,ui){
           $.get('srv/player/volume/set/' + slider.val())
       })

    })

if (document.URL.search('#browser')!= -1)
   $.get('srv/browse/', browseHandle)
});
</script>
</body>
</html>
